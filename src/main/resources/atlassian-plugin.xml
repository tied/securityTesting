<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}" />
       	<param name="atlassian-data-center-compatible">true</param>
		<param name="atlassian-data-center-status">compatible</param>
        <param name="plugin-icon">images/icon.png</param>
        <param name="plugin-logo">images/logo.png</param>
        <param name="configure.url">/admin/plugins/confluence-oauth/configure.action</param>
      <param name="atlassian-licensing-enabled">true</param>
    </plugin-info>

    <!-- add our i18n resource -->
    <resource type="i18n" name="i18n" location="confluence-oauth"/>

    <!-- add our web resources -->
    <web-resource key="oauth.plugin.auth.resources"
		i18n-name-key="oauth.plugin.admin.resources" name="Authentication Resources">
		<resource name="confluence-oauth.js" type="download"
			location="js/confluence-oauth.js" />
		<context>atl.general</context>
	</web-resource>

	<web-resource key="oauth.plugin.admin.resources"
		i18n-name-key="oauth.plugin.admin.resources" name="Admin Resources">
		<dependency>com.atlassian.auiplugin:aui-select2</dependency>
		<dependency>confluence.web.resources:ajs</dependency>
		<resource name="confluence-oauth.css" type="download"
			location="css/confluence-oauth.css" />
		<context>atl.general</context>
	</web-resource>

	<web-resource key="oauth.plugin.image.resource"
				  i18n-name-key="oauth.plugin.image.resource" name="Youtube Icon">
		<resource name="yticon/" type="download"
				  location="/images" />
		<context>atl.general</context>
	</web-resource>

	<web-item name="OAuth Client Configuration Menu" i18n-name-key="oauth.config.menu"
		key="oauth.config.menu" section="system.admin/security" weight="150">
		<description key="oauth.config.menu.desc">This display menu item for configuring
			the plugin in System settings under Security.
		</description>
		<label key="miniOrange OAuth Client">miniOrange OAuth Client</label>
		<link linkId="oauth.config.menu.link">/admin/plugins/confluence-oauth/configure.action
		</link>
	</web-item>

    <xwork name="XWork Actions" key="auth-configure-xwork">
		<package name="oauth configuration package" extends="default"
			namespace="/admin/plugins/confluence-oauth">

			<!--<action name="account"
				class="com.miniorange.oauth.confluence.action.MoLicenseDetailsAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/account.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/account.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm </result>
			</action>-->

			<action name="configure"
				class="com.miniorange.oauth.confluence.action.MoOAuthConfigurationAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/configure.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/configure.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm
				</result>
			</action>

			<action name="attributemappingconfig"
				class="com.miniorange.oauth.confluence.action.MoOAuthAttributeMappingAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/attributemappingconfig.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/attributemappingconfig.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm
				</result>
			</action>

		  	<action name="groupmappingconfig"
				class="com.miniorange.oauth.confluence.action.MoOAuthGroupMappingAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/groupmappingconfig.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/groupmappingconfig.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm
				</result>
			</action>

			<action name="signinoptions"
				class="com.miniorange.oauth.confluence.action.MoOAuthSignInSettingsAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/signinoptions.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/signinoptions.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm
				</result>
			</action>

			<action name="sessionManagement"
				class="com.miniorange.oauth.confluence.action.MoOAuthSessionManagementAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/sessionManagement.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/sessionManagement.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm
				</result>
			</action>

			<action name="importexport"
					class="com.miniorange.oauth.confluence.action.MoOAuthImportExportAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/importexport.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/importexport.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm
				</result>
			</action>
			<action name="contactus"
				class="com.miniorange.oauth.confluence.action.MoOAuthContactUsAction">
				<interceptor-ref name="defaultStack" />
				<result name="input" type="velocity">/template/com/miniorange/oauth/confluence/contactus.vm
				</result>
				<result name="success" type="velocity">/template/com/miniorange/oauth/confluence/contactus.vm
				</result>
				<result name="invalid" type="redirect">/plugins/servlet/upm
				</result>
			</action>

		</package>
	</xwork>
	<component i18n-name-key="oauth.websudo.session.handler" key="oauth.websudo.session.handler" name="WebSudo Session Manager" class="com.atlassian.confluence.security.websudo.DefaultWebSudoManager" />
    <component i18n-name-key="oauth.authenticator" key="oauth.authenticator" name="OAuth Authenticator" class="com.miniorange.oauth.confluence.MoOAuthAuthenticator" />
  	<component i18n-name-key="oauth.plugin.settings" key="oauth.plugin.settings" name="OAuth Plugin Settings" class="com.miniorange.oauth.confluence.MoOAuthSettings" />
    <component i18n-name-key="oauth.plugin.utils" key="oauth.plugin.utils" name="OAuth Client Utils" class="com.miniorange.oauth.utils.MoOAuthUtils" />
	<component i18n-name-key="oauth.plugin.handler" key="oauth.plugin.handler" name="OAuth Plugin Handler" class="com.miniorange.oauth.confluence.MoOAuthPluginHandler" />
    <component i18n-name-key="oauth.plugin.manager" key="oauth.plugin.manager" name="OAuth Client Manager" class="com.miniorange.oauth.confluence.MoOAuthManager" />
	<component i18n-name-key="oauth.pluginconfigurations.handler" key="oauth.pluginconfigurations.handler" name="OAuth Plugin configuration Handler" class="com.miniorange.oauth.confluence.MoOAuthPluginConfigurationsHandler" />
	<component i18-name-key="oauth.plugin.settings.migration" key="oauth.plugin.settings.migration"
			   class="com.miniorange.oauth.confluence.MoOAuthMigrationEvent" public="true">
		<description>The plugin component that migrates the plugin settings.</description>
		<interface>org.springframework.beans.factory.DisposableBean</interface>
		<interface>org.springframework.beans.factory.InitializingBean</interface>
	</component>

	<component-import key="oauth.upm.license"
		interface="com.atlassian.upm.api.license.PluginLicenseManager" />

	<component-import i18n-name-key="samlsso.crowd.service"
		key="samlsso.crowd.service" name="Crowd Service" interface="com.atlassian.crowd.embedded.api.CrowdService"
		filter="" />

	<component-import i18n-name-key="oauth.plugin.settings.factory"
		key="oauth.plugin.settings.factory" name="Plugin Settings Factory"
		interface="com.atlassian.sal.api.pluginsettings.PluginSettingsFactory" filter="" />

	 <component-import i18n-name-key="oauth.user.manager"
		key="user.manager" name="User Manager" interface="com.atlassian.sal.api.user.UserManager" filter="" />

	<component-import key="renderer" interface="com.atlassian.templaterenderer.velocity.one.six.VelocityTemplateRenderer" />

	 <servlet name="Get Configuration Servlet" i18n-name-key="oauth.config.servlet" key="oauth.config.servlet" class="com.miniorange.oauth.confluence.servlet.MoOAuthGetConfigurationServlet">
     	<description key="oauth.config.servlet.desc">This module handles configuration of your
			OAuth.</description>
     	<url-pattern>/oauth/getconfig</url-pattern>
     </servlet>

	 <servlet name="Login with OAuth Provider" i18n-name-key="oauth.login" key="oauth.login"
	 	class="com.miniorange.oauth.confluence.servlet.MoOAuthLoginServlet">
      	<description key="oauth.login.desc">This module handles login with your
			OAuth Provider.</description>
      	<url-pattern>/oauth/auth</url-pattern>
   	 </servlet>

	<servlet name="Auto Login with OAuth Provider" i18n-name-key="oauth.autoLogin" key="oauth.autoLogin"
			 class="com.miniorange.oauth.confluence.servlet.MoOAuthAutoLoginServlet">
		<description key="oauth.autoLogin.desc">This module handles login with your
			OAuth Provider.</description>
		<url-pattern>/oauth/autoAuth</url-pattern>
	</servlet>
	<servlet name="Configure Plugin Rest" i18n-name-key="oauth.config.configureplugin" key="oauth.config.configureplugin"
			 class="com.miniorange.oauth.confluence.servlet.MoConfigurePlugin">
		<description key="oauth.config.MoConfigurePlugin.desc">This module allows to get and configure plugin with REST API
		</description>
		<url-pattern>/oauth/configureplugin</url-pattern>
	</servlet>

     <servlet name="Get authorization response of OAuth Provider" i18n-name-key="oauth.callback" key="oauth.callback"
     	class="com.miniorange.oauth.confluence.servlet.MoOAuthCallbackServlet">
      	<description key="oauth.callback.desc">This module handles the authorization response of your OAuth Provider.</description>
      	<url-pattern>/oauth/callback</url-pattern>
    </servlet>

    <servlet name="Get authorization response of OAuth Provider in cuscumize callback" i18n-name-key="oauth.customize.callback"
    key="oauth.customize.callback" class="com.miniorange.oauth.confluence.servlet.MoOAuthCallbackServlet">
      <description key="oauth.customize.callback.desc">This module handles the customize callback authorization response of your
			OAuth Provider.</description>
      <url-pattern>/oauth/callback/*</url-pattern>
   </servlet>

	<servlet name="Get authorization response of OAuth Provider" i18n-name-key="oauth.autoCallback" key="oauth.autoCallback"
			 class="com.miniorange.oauth.confluence.servlet.MoOAuthAutoCallbackServlet">
		<description key="oauth.callback.desc">This module handles the authorization response of your OAuth Provider.</description>
		<url-pattern>/oauth/autocallback</url-pattern>
	</servlet>

	<servlet name="Fetch Metadata Servlet" i18n-name-key="oauth.metadata.servlet" key="oauth.metadata.servlet"
			 class="com.miniorange.oauth.confluence.servlet.MoOAuthFetchMetadataServlet">
		<description key="oauth.metadata.servlet.desc">This module fetches the metadata from a metadata url of your
			OAuth/OpenID Provider.</description>
		<url-pattern>/oauth/fetchmetadata</url-pattern>
	</servlet>
    <servlet name="Download App Guide" i18n-name-key="oauth.config.downloadappguides" key="oauth.config.downloadappguides"
		class="com.miniorange.oauth.confluence.servlet.MoOAuthDownloadAppGuidesServlet">
		<description key="oauth.config.downloadappguides.desc">This module allows you to download Guides for your Application.</description>
		<url-pattern>/oauth/downloadappguides</url-pattern>
	</servlet>

	<servlet name="Download App Video Guide" i18n-name-key="oauth.config.downloadappvideoguides" key="oauth.config.downloadappvideoguides"
			 class="com.miniorange.oauth.confluence.servlet.MoOAuthDownloadAppVideoGuidesServlet">
		<description key="oauth.config.downloadappvideoguides.desc">This module allows you to download Video Guides for your Application.</description>
		<url-pattern>/oauth/downloadappvideoguides</url-pattern>
	</servlet>

	<servlet name="Reset Plugin Settings" i18n-name-key="oauth.config.resetpluginsettings" key="oauth.config.resetpluginsettings"
			 class="com.miniorange.oauth.confluence.servlet.MoOAuthResetSettingsServlet">
		<description key="oauth.config.resetpluginsettings.desc">This module allows you to clear plugin settings.
		</description>
		<url-pattern>/oauth/moconfreset</url-pattern>
	</servlet>

	<servlet name="Custome Logout Template Render" i18n-name-key="oauth.config.moRenderLogoutTemplate" key="oauth.config.moRenderLogoutTemplate"
			 class="com.miniorange.oauth.confluence.servlet.MoRenderLogoutTemplate">
		<description key="oauth.config.moRenderLogoutTemplate.desc">This module render custom logout template
		</description>
		<url-pattern>/oauth/logout</url-pattern>
	</servlet>

	<servlet name="Session Timeout Servlet" i18n-name-key="oauth.config.moOAuthSessionTimeoutServlet" key="oauth.config.moOAuthSessionTimeoutServlet"
			 class="com.miniorange.oauth.confluence.servlet.MoOAuthSessionTimeoutServlet">
		<description key="oauth.config.moOAuthSessionTimeoutServlet.desc">This module render Session Timeout Servlet
		</description>
		<url-pattern>/oauth/sessiontimeout</url-pattern>
	</servlet>


	<servlet name="downloadconfigurations" i18n-name-key="oauth.config.downloadconfigurations"
			 key="oauth.config.downloadconfigurations" class="com.miniorange.oauth.confluence.servlet.MoOAuthDownloadConfigurationsServlet">
		<description key="oauth.config.downloadconfigurations.desc">This module download the saved plugin configuration.
		</description>
		<url-pattern>/oauth/downloadconfigurations</url-pattern>
	</servlet>

	<servlet name="Enable Backdoor URl" i18n-name-key="oauth.config.enablebackdoorurl" key="oauth.config.enablebackdoorurl"
			 class="com.miniorange.oauth.confluence.servlet.MoEnableBackdoorUrl">
		<description key="oauth.config.enablebackdoorurl.desc">This module allows you to enable Backdoor URL.
		</description>
		<url-pattern>/oauth/enablebackdoorurl</url-pattern>
	</servlet>

	<servlet name="Ajax Action Calls" i18n-name-key="oauth.config.moajaxcallservlet" key="oauth.config.moajaxcallservlet"
			 class="com.miniorange.oauth.confluence.servlet.MoAjaxCallsServlet">
		<description key="oauth.config.ajax.desc">This module provides different ajax functions.
		</description>
		<url-pattern>/oauth/moapi</url-pattern>
	</servlet>

	<servlet-filter name="OAuth SSO Filter" key="oauth-logout-filter"
		location="before-login"
		class="com.miniorange.oauth.confluence.servlet.MoOAuthLogoutFilter"
		weight="0">
		<description>
			Force users to redirect to the custom logout page/URL after successful logout from the system.
		</description>
		<url-pattern>/login.action</url-pattern>
		<dispatcher>REQUEST</dispatcher>
		<dispatcher>FORWARD</dispatcher>
	</servlet-filter>

	<servlet-filter name="miniOrange OAuth Filter" key="oauth-redirect-filter" location="before-dispatch"
					class="com.miniorange.oauth.confluence.servlet.MoOAuthServletFilter" weight="200">
		<description>Invoke OAuth</description>
		<url-pattern>/*</url-pattern>
		<dispatcher>REQUEST</dispatcher>
		<dispatcher>FORWARD</dispatcher>
	</servlet-filter>

	<servlet-filter name="OAuth SSO Redirect Filter" key="oauth-redirect"
					location="before-dispatch"
					class="com.miniorange.oauth.confluence.servlet.MoOAuthRedirectFilter"
					weight="200">
		<description>
			Force users to redirect to the idp if auto redirect is on.
		</description>
		<url-pattern>/login.action</url-pattern>
		<dispatcher>REQUEST</dispatcher>
		<dispatcher>FORWARD</dispatcher>
	</servlet-filter>

</atlassian-plugin>
